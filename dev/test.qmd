---
title: testing
---

```{r}
library(readr)
library(purrr)
library(dplyr)
library(ggplot2)
library(ggdensity)

s01_dat <- read_csv(
  "https://lin611-2024.github.io/notes/meetings/data/s01_dat.csv"
) 
```



```{r}
speaker_tracks |> 
  norm_track_generic(
    F1:F3,
    .by = speaker,
    .token_id_col = id,
    .time_col = t,
    .L = mean(.formant, na.rm = T),
    .S = sd(.formant, na.rm = T),
    .by_formant = T,
    .return_dct = F
  ) |> 
  ggplot(
    aes(-F2_n, -F1_n, color = speaker)
  ) +
  stat_density_2d()+
  coord_fixed()
```
```{r}
speaker_tracks |>
  norm_track_generic(
    F1:F3,
    .by = speaker,
    .token_id_col = id,
    .by_formant = TRUE,
    .L = mean(.formant, na.rm = TRUE),
    .S = sd(.formant, na.rm = TRUE),
    .time_col = t
  )

speaker_tracks |> 
 norm_track_generic(
    F1:F3,
    .by = speaker,
    .token_id_col = id,
    .time_col = t,
    .L = mean(.formant, na.rm = T),
    .S = sd(.formant, na.rm = T),
    .by_formant = T,
    .return_dct = F,
    .drop_orig = T
  ) 
```
```{r}
speaker_tracks |> 
  filter(
    .by = c(speaker, id),
    if_all(
      F1:F3,
      .fns =\(x) mean(is.finite(x)) > 0.9
    ),
    row_number() %% 2 == 1
  ) -> small_tracks


small_tracks |> 
  norm_track_lobanov(
    F1:F3,
    .by = speaker,
    .token_id_col = id,
    .time_col = t
  ) |> 
  ggplot(
    aes(-F2_z, -F1_z, color = speaker)
  )+
  stat_density_2d()+
  coord_fixed()
```



